```python
# import necessary libraries
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
import yfinance as yf
import scipy.optimize as sco
import investpy
import datetime
from dateutil.relativedelta import relativedelta
```

<span style="color:blue">Each group of students (of no more than 4) will collect daily data for at least five years on the following instruments: at least six stocks, two corporate bonds of your choice, and two commodities of your choice. Use assets traded on US exchanges and markets. You are free to use mutual funds or Exchnage-Traded Funds instead of individual assets. Also, collect the risk-free rate of your choice and the S&P 500 index. The project must be executed using EXCEL. You should perform, at least, the following tasks for the completion of the project along with the suitable explanations (both narrative/verbal and mathematical): 
</span>



```python
# given a list of tickers, this function returns a DataFrame with the Adj Close for the assets specified 
# and the period specified
def get_data(tickers_list, period,interval = '1mo'):
    data = pd.DataFrame(columns=tickers_list)

    for ticker in tickers_list:
        t = yf.Ticker(ticker)
        temp = t.history(period=period,interval=interval)
        data[ticker] = temp.Close
    
    return data
```


```python
# portfolio allocation for stocks, bonds and commodities respectively
ss, bb, cc = 0.7, 0.2, 0.1

# instrument selection
stocks = ['QCOM',
          'TEAM',
          'TSLA',
          'BABA',
#           'ALXN',
          'BLK'
         ]
bonds = [
    'PYACX',
    'VWEHX'
  ]
commodities = ['gold','palladium']

rf = 1.3
sp500 = ['^GSPC']

assets = stocks + bonds + commodities +sp500
print(assets)
```

    ['QCOM', 'TEAM', 'TSLA', 'BABA', 'BLK', 'PYACX', 'VWEHX', 'gold', 'palladium', '^GSPC']



```python
# fetch daily historical prices (Adj Close) from Yahoo! Finance
d0 = get_data(stocks + bonds, '5y',interval='1d').dropna()
benchmark = get_data(sp500, '5y',interval='1d').dropna()
```


```python
d = datetime.datetime.now() - relativedelta(years=5)
from_date = str(d.day) + '/' + str(d.month) + '/' + str(d.year)
d = datetime.datetime.now()
to_date = str(d.day) + '/' + str(d.month) + '/' + str(d.year)

d1 = investpy.commodities.get_commodity_historical_data(commodity=commodities[0],from_date=from_date, to_date=to_date)['Close']
d2 = investpy.commodities.get_commodity_historical_data(commodity=commodities[1],from_date=from_date, to_date=to_date)['Close']
```


```python
# Place the DataFrames side by side
c = pd.concat([d1, d2], axis=1)
c.columns = commodities
```


```python
c.shape
```




    (1411, 2)




```python
data = pd.concat([d0, c, benchmark], axis=1)
data = data.dropna()
data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>QCOM</th>
      <th>TEAM</th>
      <th>TSLA</th>
      <th>BABA</th>
      <th>BLK</th>
      <th>PYACX</th>
      <th>VWEHX</th>
      <th>gold</th>
      <th>palladium</th>
      <th>^GSPC</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-12-09</th>
      <td>41.87</td>
      <td>21.00</td>
      <td>224.52</td>
      <td>83.42</td>
      <td>310.58</td>
      <td>9.16</td>
      <td>4.48</td>
      <td>1117.3</td>
      <td>552.55</td>
      <td>2047.62</td>
    </tr>
    <tr>
      <th>2015-12-10</th>
      <td>41.86</td>
      <td>27.78</td>
      <td>227.07</td>
      <td>84.33</td>
      <td>311.19</td>
      <td>9.15</td>
      <td>4.48</td>
      <td>1112.7</td>
      <td>542.70</td>
      <td>2052.23</td>
    </tr>
    <tr>
      <th>2015-12-11</th>
      <td>40.90</td>
      <td>27.50</td>
      <td>217.02</td>
      <td>79.74</td>
      <td>290.94</td>
      <td>9.20</td>
      <td>4.43</td>
      <td>1116.2</td>
      <td>545.05</td>
      <td>2012.37</td>
    </tr>
    <tr>
      <th>2015-12-14</th>
      <td>40.36</td>
      <td>26.26</td>
      <td>218.58</td>
      <td>80.57</td>
      <td>288.07</td>
      <td>9.12</td>
      <td>4.38</td>
      <td>1103.8</td>
      <td>549.15</td>
      <td>2021.94</td>
    </tr>
    <tr>
      <th>2015-12-15</th>
      <td>41.38</td>
      <td>26.50</td>
      <td>221.09</td>
      <td>82.49</td>
      <td>297.03</td>
      <td>9.11</td>
      <td>4.41</td>
      <td>1102.2</td>
      <td>567.40</td>
      <td>2043.41</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-01-22</th>
      <td>92.97</td>
      <td>131.46</td>
      <td>569.56</td>
      <td>222.37</td>
      <td>536.86</td>
      <td>11.89</td>
      <td>5.98</td>
      <td>1556.7</td>
      <td>2391.00</td>
      <td>3321.75</td>
    </tr>
    <tr>
      <th>2020-01-23</th>
      <td>92.00</td>
      <td>132.64</td>
      <td>572.20</td>
      <td>219.13</td>
      <td>541.94</td>
      <td>11.91</td>
      <td>5.97</td>
      <td>1565.4</td>
      <td>2365.25</td>
      <td>3325.54</td>
    </tr>
    <tr>
      <th>2020-01-24</th>
      <td>89.65</td>
      <td>146.79</td>
      <td>564.82</td>
      <td>213.75</td>
      <td>536.84</td>
      <td>11.95</td>
      <td>5.96</td>
      <td>1571.9</td>
      <td>2322.00</td>
      <td>3295.47</td>
    </tr>
    <tr>
      <th>2020-01-27</th>
      <td>87.05</td>
      <td>143.83</td>
      <td>558.02</td>
      <td>205.47</td>
      <td>523.81</td>
      <td>11.97</td>
      <td>5.93</td>
      <td>1577.4</td>
      <td>2193.50</td>
      <td>3243.63</td>
    </tr>
    <tr>
      <th>2020-01-28</th>
      <td>89.15</td>
      <td>149.27</td>
      <td>566.90</td>
      <td>210.23</td>
      <td>529.97</td>
      <td>11.94</td>
      <td>5.95</td>
      <td>1569.8</td>
      <td>2180.10</td>
      <td>3276.24</td>
    </tr>
  </tbody>
</table>
<p>1040 rows × 10 columns</p>
</div>




```python
# show the DataFrame
data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>QCOM</th>
      <th>TEAM</th>
      <th>TSLA</th>
      <th>BABA</th>
      <th>BLK</th>
      <th>PYACX</th>
      <th>VWEHX</th>
      <th>gold</th>
      <th>palladium</th>
      <th>^GSPC</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-12-09</th>
      <td>41.87</td>
      <td>21.00</td>
      <td>224.52</td>
      <td>83.42</td>
      <td>310.58</td>
      <td>9.16</td>
      <td>4.48</td>
      <td>1117.3</td>
      <td>552.55</td>
      <td>2047.62</td>
    </tr>
    <tr>
      <th>2015-12-10</th>
      <td>41.86</td>
      <td>27.78</td>
      <td>227.07</td>
      <td>84.33</td>
      <td>311.19</td>
      <td>9.15</td>
      <td>4.48</td>
      <td>1112.7</td>
      <td>542.70</td>
      <td>2052.23</td>
    </tr>
    <tr>
      <th>2015-12-11</th>
      <td>40.90</td>
      <td>27.50</td>
      <td>217.02</td>
      <td>79.74</td>
      <td>290.94</td>
      <td>9.20</td>
      <td>4.43</td>
      <td>1116.2</td>
      <td>545.05</td>
      <td>2012.37</td>
    </tr>
    <tr>
      <th>2015-12-14</th>
      <td>40.36</td>
      <td>26.26</td>
      <td>218.58</td>
      <td>80.57</td>
      <td>288.07</td>
      <td>9.12</td>
      <td>4.38</td>
      <td>1103.8</td>
      <td>549.15</td>
      <td>2021.94</td>
    </tr>
    <tr>
      <th>2015-12-15</th>
      <td>41.38</td>
      <td>26.50</td>
      <td>221.09</td>
      <td>82.49</td>
      <td>297.03</td>
      <td>9.11</td>
      <td>4.41</td>
      <td>1102.2</td>
      <td>567.40</td>
      <td>2043.41</td>
    </tr>
  </tbody>
</table>
</div>




```python
returns = data.pct_change()[1:]
```


```python
# plot historical prices for all assets
plt.figure(figsize=(14, 7))
for c in data.columns[:-1].values:
    plt.plot(data.index, data[c], lw=2, alpha=0.8,label=c)
plt.legend(loc='upper left', fontsize='x-large',shadow=True)
plt.ylabel('daily prices', fontsize='x-large')
plt.savefig('../report/media/daily_prices.png', bbox_inches='tight')
```

    C:\Users\nikdim\Anaconda3\envs\nikdim\lib\site-packages\pandas\plotting\_matplotlib\converter.py:103: FutureWarning: Using an implicitly registered datetime converter for a matplotlib plotting method. The converter was registered by pandas on import. Future versions of pandas will require you to explicitly register matplotlib converters.
    
    To register the converters:
    	>>> from pandas.plotting import register_matplotlib_converters
    	>>> register_matplotlib_converters()
      warnings.warn(msg, FutureWarning)



![png](FN4329_files/FN4329_11_1.png)


## Question 1
 <span style="color:blue">Decide on the allocation of your budget to each of the above instruments. Rationalize your choice based on your own investment philosophy. You should fill out a risk tolerance questionnaire and supply both the questionnaire and its suggested allocation (in the project’s Appendix). In your discussion, please explain the choice of your investment vehicles and their significance in your portfolio. Label this as your investment policy statement (IPS). </span>

 <span style="color:red">**SEE REPORT**</span>

## Question 2
<span style="color:blue">Outline your investment objectives, constraints and strategies and discuss the relative importance of risk and return in your investment decision making.</span>

 <span style="color:red">**SEE REPORT**</span>

## Question 3
<span style="color:blue">Provide a preliminary discussion of the effects of the short investment horizon in your decision(s) and diversification strategy.</span>

 <span style="color:red">**SEE REPORT**</span>

## Question 4
<span style="color:blue">Compute the descriptive statistics for each instrument. Explain each metric you computed from the perspective of the investor. Provide graphs as well. </span>

Descriptive statistics are broken down into measures of central tendency and measures of variability (spread). Measures of central tendency include the mean, median, and mode, while measures of variability include the standard deviation, variance, the minimum and maximum variables, and the kurtosis and skewness.


```python
# mean
# median
# mode -> decided not to measure since a distribution can have multiple modes 

# standard deviation
# variance
# minimum
# maximum
# kurtosis
# skewness
```


```python
q4 = ['mean','median','std','var','min','max','kurtosis','skewness']
q5 = ['alpha','beta','r-squared']
```


```python
df = pd.DataFrame(columns= q4+q5,index=assets)
```


```python
import statistics
import scipy.stats

for i in range(len(assets)):
    # fetch returns for asset i
    l = returns[assets[i]].tolist()
    # compute descriptive statistics for instrument i
    df.iloc[i]['mean'] = statistics.mean(l)
    df.iloc[i]['median'] = statistics.median(l)
    df.iloc[i]['std'] = statistics.stdev(l)
    df.iloc[i]['var'] = statistics.variance(l)
    df.iloc[i]['min'] = min(l)
    df.iloc[i]['max'] = max(l)
    df.iloc[i]['kurtosis'] = scipy.stats.kurtosis(l)
    df.iloc[i]['skewness'] = scipy.stats.skew(l)
  
# print df
df.iloc[:,:-len(q5)].T
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>QCOM</th>
      <th>TEAM</th>
      <th>TSLA</th>
      <th>BABA</th>
      <th>BLK</th>
      <th>PYACX</th>
      <th>VWEHX</th>
      <th>gold</th>
      <th>palladium</th>
      <th>^GSPC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>0.000921521</td>
      <td>0.00228456</td>
      <td>0.00131788</td>
      <td>0.00108266</td>
      <td>0.000612791</td>
      <td>0.000257935</td>
      <td>0.000276397</td>
      <td>0.000356155</td>
      <td>0.00146108</td>
      <td>0.000485619</td>
    </tr>
    <tr>
      <th>median</th>
      <td>0.000942329</td>
      <td>0.00293902</td>
      <td>0.00085879</td>
      <td>0.00100722</td>
      <td>0.000664808</td>
      <td>0</td>
      <td>0</td>
      <td>0.000267785</td>
      <td>0.0021448</td>
      <td>0.000602635</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.0198444</td>
      <td>0.0284707</td>
      <td>0.0292674</td>
      <td>0.0196701</td>
      <td>0.014002</td>
      <td>0.00236856</td>
      <td>0.00254777</td>
      <td>0.00760358</td>
      <td>0.0166719</td>
      <td>0.00813403</td>
    </tr>
    <tr>
      <th>var</th>
      <td>0.000393799</td>
      <td>0.000810582</td>
      <td>0.00085658</td>
      <td>0.000386914</td>
      <td>0.000196056</td>
      <td>5.61007e-06</td>
      <td>6.49115e-06</td>
      <td>5.78144e-05</td>
      <td>0.000277954</td>
      <td>6.61625e-05</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.127205</td>
      <td>-0.15875</td>
      <td>-0.139015</td>
      <td>-0.0681706</td>
      <td>-0.0716706</td>
      <td>-0.0131579</td>
      <td>-0.0134615</td>
      <td>-0.0334349</td>
      <td>-0.0740462</td>
      <td>-0.0409792</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.232162</td>
      <td>0.322857</td>
      <td>0.176692</td>
      <td>0.132919</td>
      <td>0.0537754</td>
      <td>0.00773861</td>
      <td>0.0116505</td>
      <td>0.0452319</td>
      <td>0.0740757</td>
      <td>0.0495938</td>
    </tr>
    <tr>
      <th>kurtosis</th>
      <td>23.5332</td>
      <td>22.612</td>
      <td>5.17545</td>
      <td>2.79483</td>
      <td>2.87126</td>
      <td>1.13364</td>
      <td>4.39153</td>
      <td>3.51997</td>
      <td>1.68952</td>
      <td>4.35418</td>
    </tr>
    <tr>
      <th>skewness</th>
      <td>1.36991</td>
      <td>1.60936</td>
      <td>0.3167</td>
      <td>0.241728</td>
      <td>-0.451313</td>
      <td>-0.316738</td>
      <td>-0.339491</td>
      <td>0.290666</td>
      <td>-0.278651</td>
      <td>-0.559417</td>
    </tr>
  </tbody>
</table>
</div>




```python
dd = df.iloc[:,:-len(q5)].T
dd = dd.astype(float).round(6)
dd.to_csv('../report/media/df.csv', encoding='utf-8')
print(dd.to_latex())
```

    \begin{tabular}{lrrrrrrrrrr}
    \toprule
    {} &       QCOM &       TEAM &      TSLA &      BABA &       BLK &     PYACX &     VWEHX &      gold &  palladium &     \textasciicircum GSPC \\
    \midrule
    mean     &   0.000922 &   0.002285 &  0.001318 &  0.001083 &  0.000613 &  0.000258 &  0.000276 &  0.000356 &   0.001461 &  0.000486 \\
    median   &   0.000942 &   0.002939 &  0.000859 &  0.001007 &  0.000665 &  0.000000 &  0.000000 &  0.000268 &   0.002145 &  0.000603 \\
    std      &   0.019844 &   0.028471 &  0.029267 &  0.019670 &  0.014002 &  0.002369 &  0.002548 &  0.007604 &   0.016672 &  0.008134 \\
    var      &   0.000394 &   0.000811 &  0.000857 &  0.000387 &  0.000196 &  0.000006 &  0.000006 &  0.000058 &   0.000278 &  0.000066 \\
    min      &  -0.127205 &  -0.158750 & -0.139015 & -0.068171 & -0.071671 & -0.013158 & -0.013462 & -0.033435 &  -0.074046 & -0.040979 \\
    max      &   0.232162 &   0.322857 &  0.176692 &  0.132919 &  0.053775 &  0.007739 &  0.011650 &  0.045232 &   0.074076 &  0.049594 \\
    kurtosis &  23.533187 &  22.612034 &  5.175447 &  2.794831 &  2.871263 &  1.133641 &  4.391526 &  3.519966 &   1.689517 &  4.354180 \\
    skewness &   1.369910 &   1.609357 &  0.316700 &  0.241728 & -0.451313 & -0.316738 & -0.339491 &  0.290666 &  -0.278651 & -0.559417 \\
    \bottomrule
    \end{tabular}
    



```python
# Annotated graph for minimum and maximum
plt.style.use('seaborn-whitegrid')
fig, ax = plt.subplots(figsize=(16, 8))
data['TSLA'].plot(ax=ax)

style = dict(size=10, color='black')
# ax.text('2019-1-14', 370, "Cybertruck \n announcement", **style)
ax.annotate('Cybertruck \n announcement', xy=('2019-10-29', 280), xytext=('2019-1-14', 370),
            arrowprops=dict(facecolor='black', shrink=0.05,width=1))
plt.savefig('../report/media/cybertruck.png', bbox_inches='tight')
```


![png](FN4329_files/FN4329_25_0.png)



```python
 range(len(assets))
```




    range(0, 10)




```python
returns
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>QCOM</th>
      <th>TEAM</th>
      <th>TSLA</th>
      <th>BABA</th>
      <th>BLK</th>
      <th>PYACX</th>
      <th>VWEHX</th>
      <th>gold</th>
      <th>palladium</th>
      <th>^GSPC</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-12-10</th>
      <td>-0.000239</td>
      <td>0.322857</td>
      <td>0.011358</td>
      <td>0.010909</td>
      <td>0.001964</td>
      <td>-0.001092</td>
      <td>0.000000</td>
      <td>-0.004117</td>
      <td>-0.017826</td>
      <td>0.002251</td>
    </tr>
    <tr>
      <th>2015-12-11</th>
      <td>-0.022934</td>
      <td>-0.010079</td>
      <td>-0.044259</td>
      <td>-0.054429</td>
      <td>-0.065073</td>
      <td>0.005464</td>
      <td>-0.011161</td>
      <td>0.003146</td>
      <td>0.004330</td>
      <td>-0.019423</td>
    </tr>
    <tr>
      <th>2015-12-14</th>
      <td>-0.013203</td>
      <td>-0.045091</td>
      <td>0.007188</td>
      <td>0.010409</td>
      <td>-0.009865</td>
      <td>-0.008696</td>
      <td>-0.011287</td>
      <td>-0.011109</td>
      <td>0.007522</td>
      <td>0.004756</td>
    </tr>
    <tr>
      <th>2015-12-15</th>
      <td>0.025273</td>
      <td>0.009139</td>
      <td>0.011483</td>
      <td>0.023830</td>
      <td>0.031104</td>
      <td>-0.001096</td>
      <td>0.006849</td>
      <td>-0.001450</td>
      <td>0.033233</td>
      <td>0.010619</td>
    </tr>
    <tr>
      <th>2015-12-16</th>
      <td>0.001208</td>
      <td>0.001509</td>
      <td>0.060699</td>
      <td>0.025943</td>
      <td>0.004410</td>
      <td>0.000000</td>
      <td>0.002268</td>
      <td>0.014063</td>
      <td>0.008724</td>
      <td>0.014515</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-01-22</th>
      <td>-0.016607</td>
      <td>0.001066</td>
      <td>0.040863</td>
      <td>0.000495</td>
      <td>0.014590</td>
      <td>0.000842</td>
      <td>0.000000</td>
      <td>-0.000770</td>
      <td>0.074076</td>
      <td>0.000289</td>
    </tr>
    <tr>
      <th>2020-01-23</th>
      <td>-0.010433</td>
      <td>0.008976</td>
      <td>0.004635</td>
      <td>-0.014570</td>
      <td>0.009462</td>
      <td>0.001682</td>
      <td>-0.001672</td>
      <td>0.005589</td>
      <td>-0.010770</td>
      <td>0.001141</td>
    </tr>
    <tr>
      <th>2020-01-24</th>
      <td>-0.025543</td>
      <td>0.106680</td>
      <td>-0.012898</td>
      <td>-0.024552</td>
      <td>-0.009411</td>
      <td>0.003359</td>
      <td>-0.001675</td>
      <td>0.004152</td>
      <td>-0.018286</td>
      <td>-0.009042</td>
    </tr>
    <tr>
      <th>2020-01-27</th>
      <td>-0.029002</td>
      <td>-0.020165</td>
      <td>-0.012039</td>
      <td>-0.038737</td>
      <td>-0.024272</td>
      <td>0.001674</td>
      <td>-0.005034</td>
      <td>0.003499</td>
      <td>-0.055340</td>
      <td>-0.015731</td>
    </tr>
    <tr>
      <th>2020-01-28</th>
      <td>0.024124</td>
      <td>0.037822</td>
      <td>0.015913</td>
      <td>0.023166</td>
      <td>0.011760</td>
      <td>-0.002506</td>
      <td>0.003373</td>
      <td>-0.004818</td>
      <td>-0.006109</td>
      <td>0.010054</td>
    </tr>
  </tbody>
</table>
<p>1039 rows × 10 columns</p>
</div>




```python
# plt.style.use('seaborn-whitegrid')

fig, ax = plt.subplots(4,3,figsize=(12, 9), sharex=True)
for i in range(len(assets)):
    sns.distplot(returns[assets[i]],fit=scipy.stats.skewnorm, kde=False, ax=ax[i//3, np.mod(i,3)])
plt.savefig('../report/media/distplot.png', bbox_inches='tight')
```


![png](FN4329_files/FN4329_28_0.png)


## Question 5
<span style="color:blue">Compute additional metrics for the assets such as the correlation and covariance matrices, for the entire and two subperiods (of your own choosing), if needed. Interpret your findings. Also, compute each fund’s alpha, beta, R-square. Interpret your findings from the perspective of the investor.</span>


```python
print(returns.cov().to_latex())
print('\n')
print(returns.corr().to_latex())
```

    \begin{tabular}{lrrrrrrrrrr}
    \toprule
    {} &      QCOM &      TEAM &      TSLA &      BABA &       BLK &         PYACX &         VWEHX &      gold &  palladium &     \textasciicircum GSPC \\
    \midrule
    QCOM      &  0.000394 &  0.000138 &  0.000116 &  0.000141 &  0.000121 & -6.761679e-06 &  1.027417e-05 & -0.000020 &   0.000042 &  0.000080 \\
    TEAM      &  0.000138 &  0.000811 &  0.000167 &  0.000175 &  0.000111 & -4.098970e-06 &  1.331404e-05 & -0.000011 &   0.000038 &  0.000093 \\
    TSLA      &  0.000116 &  0.000167 &  0.000857 &  0.000169 &  0.000106 & -5.648866e-06 &  1.360635e-05 & -0.000013 &   0.000057 &  0.000087 \\
    BABA      &  0.000141 &  0.000175 &  0.000169 &  0.000387 &  0.000122 & -4.224175e-06 &  1.450409e-05 & -0.000012 &   0.000067 &  0.000093 \\
    BLK       &  0.000121 &  0.000111 &  0.000106 &  0.000122 &  0.000196 & -8.851623e-06 &  1.374404e-05 & -0.000019 &   0.000050 &  0.000090 \\
    PYACX     & -0.000007 & -0.000004 & -0.000006 & -0.000004 & -0.000009 &  5.610073e-06 &  7.027645e-07 &  0.000007 &  -0.000001 & -0.000004 \\
    VWEHX     &  0.000010 &  0.000013 &  0.000014 &  0.000015 &  0.000014 &  7.027645e-07 &  6.491153e-06 & -0.000002 &   0.000007 &  0.000009 \\
    gold      & -0.000020 & -0.000011 & -0.000013 & -0.000012 & -0.000019 &  6.612944e-06 & -1.918765e-06 &  0.000058 &   0.000029 & -0.000011 \\
    palladium &  0.000042 &  0.000038 &  0.000057 &  0.000067 &  0.000050 & -1.173603e-06 &  7.206858e-06 &  0.000029 &   0.000278 &  0.000030 \\
    \textasciicircum GSPC     &  0.000080 &  0.000093 &  0.000087 &  0.000093 &  0.000090 & -4.288050e-06 &  8.913414e-06 & -0.000011 &   0.000030 &  0.000066 \\
    \bottomrule
    \end{tabular}
    
    
    
    \begin{tabular}{lrrrrrrrrrr}
    \toprule
    {} &      QCOM &      TEAM &      TSLA &      BABA &       BLK &     PYACX &     VWEHX &      gold &  palladium &     \textasciicircum GSPC \\
    \midrule
    QCOM      &  1.000000 &  0.243419 &  0.199395 &  0.361220 &  0.436478 & -0.143858 &  0.203212 & -0.135153 &   0.126725 &  0.497517 \\
    TEAM      &  0.243419 &  1.000000 &  0.200639 &  0.312442 &  0.279119 & -0.060784 &  0.183548 & -0.050210 &   0.081051 &  0.400008 \\
    TSLA      &  0.199395 &  0.200639 &  1.000000 &  0.294151 &  0.259546 & -0.081488 &  0.182472 & -0.058540 &   0.116378 &  0.365220 \\
    BABA      &  0.361220 &  0.312442 &  0.294151 &  1.000000 &  0.441629 & -0.090667 &  0.289416 & -0.077828 &   0.204843 &  0.578349 \\
    BLK       &  0.436478 &  0.279119 &  0.259546 &  0.441629 &  1.000000 & -0.266900 &  0.385268 & -0.180232 &   0.213814 &  0.787960 \\
    PYACX     & -0.143858 & -0.060784 & -0.081488 & -0.090667 & -0.266900 &  1.000000 &  0.116457 &  0.367191 &  -0.029720 & -0.222572 \\
    VWEHX     &  0.203212 &  0.183548 &  0.182472 &  0.289416 &  0.385268 &  0.116457 &  1.000000 & -0.099047 &   0.169668 &  0.430108 \\
    gold      & -0.135153 & -0.050210 & -0.058540 & -0.077828 & -0.180232 &  0.367191 & -0.099047 &  1.000000 &   0.228830 & -0.179643 \\
    palladium &  0.126725 &  0.081051 &  0.116378 &  0.204843 &  0.213814 & -0.029720 &  0.169668 &  0.228830 &   1.000000 &  0.218967 \\
    \textasciicircum GSPC     &  0.497517 &  0.400008 &  0.365220 &  0.578349 &  0.787960 & -0.222572 &  0.430108 & -0.179643 &   0.218967 &  1.000000 \\
    \bottomrule
    \end{tabular}
    



```python
fig, ax = plt.subplots(figsize=(12, 9))
sns.heatmap(returns.corr(), annot=True,  linewidths=.5, ax=ax)
plt.yticks(rotation=0)
bottom, top = ax.get_ylim()
ax.set_ylim(bottom + 0.5, top - 0.5)
plt.savefig('../report/media/correlation_matrix.png', bbox_inches='tight')
```


![png](FN4329_files/FN4329_31_0.png)



```python
# sns.pairplot(returns, kind='reg')
# plt.savefig('../report/media/pairplot.png', bbox_inches='tight')
```


```python
# sns.jointplot('^GSPC', 'TSLA', returns, kind='reg')
```


```python
# y = returns[assets[0]].values
# x = returns[assets[-1]].values
# g = sns.JointGrid(x=x, y=y)
# g = g.plot(sns.regplot, sns.distplot)
# # sns.regplot(x, y)
# # sns.jointplot('^GSPC', 'TSLA', returns, kind='reg')
# plt.xlabel("Benchmark Returns")
# plt.ylabel("TSLA")
# # plt.suptitle("Portfolio Returns vs Benchmark Returns")
# plt.show()
```


```python
x = returns[assets[-1]].values
for i in range(len(assets)):
    # fetch data for asset i
    y = returns[assets[i]].values
    # compute alpha, beta, r-squared for instrument i
    (beta, alpha, r_value) = scipy.stats.linregress(x,y)[0:3]
    df.iloc[i]['alpha'] = alpha
    df.iloc[i]['beta'] = beta
    df.iloc[i]['r-squared'] = r_value ** 2
```


```python
df.iloc[:-1,len(q4):].T
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>QCOM</th>
      <th>TEAM</th>
      <th>TSLA</th>
      <th>BABA</th>
      <th>BLK</th>
      <th>PYACX</th>
      <th>VWEHX</th>
      <th>gold</th>
      <th>palladium</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>alpha</th>
      <td>0.000332087</td>
      <td>0.00160464</td>
      <td>0.000679725</td>
      <td>0.000403473</td>
      <td>-4.59033e-05</td>
      <td>0.000289408</td>
      <td>0.000210975</td>
      <td>0.000437704</td>
      <td>0.00124314</td>
    </tr>
    <tr>
      <th>beta</th>
      <td>1.21378</td>
      <td>1.40011</td>
      <td>1.31411</td>
      <td>1.39859</td>
      <td>1.3564</td>
      <td>-0.0648109</td>
      <td>0.13472</td>
      <td>-0.167928</td>
      <td>0.448806</td>
    </tr>
    <tr>
      <th>r-squared</th>
      <td>0.247523</td>
      <td>0.160006</td>
      <td>0.133386</td>
      <td>0.334487</td>
      <td>0.62088</td>
      <td>0.0495381</td>
      <td>0.184993</td>
      <td>0.0322716</td>
      <td>0.0479465</td>
    </tr>
  </tbody>
</table>
</div>




```python
dd = df.iloc[:-1,len(q4):].T
dd = dd.astype(float).round(6)
dd.to_csv('../report/media/df.csv', encoding='utf-8')
print(dd.to_latex())
```

    \begin{tabular}{lrrrrrrrrr}
    \toprule
    {} &      QCOM &      TEAM &      TSLA &      BABA &       BLK &     PYACX &     VWEHX &      gold &  palladium \\
    \midrule
    alpha     &  0.000332 &  0.001605 &  0.000680 &  0.000403 & -0.000046 &  0.000289 &  0.000211 &  0.000438 &   0.001243 \\
    beta      &  1.213778 &  1.400108 &  1.314113 &  1.398591 &  1.356401 & -0.064811 &  0.134720 & -0.167928 &   0.448806 \\
    r-squared &  0.247523 &  0.160006 &  0.133386 &  0.334487 &  0.620880 &  0.049538 &  0.184993 &  0.032272 &   0.047946 \\
    \bottomrule
    \end{tabular}
    


## Question 6
<span style="color:blue">Calculate the return/risk of your risky portfolio. Explain each step in your analysis. You must use EXCEL’s mmult functions for this part of the analysis.</span>

## Question 7
<span style="color:blue">Derive and graph the Capital Allocation Line. Graph the Efficient Frontier with your available investment instruments (assets) and superimpose your CAL. Discuss the various options you may have and finalize your optimal point.</span>


```python
# produce random weight vector with stock/bond/commodity fixed allocation
def random_weights():
    s = np.random.random(len(stocks))
    s = s / np.sum(s)
    s = ss * s
    b = np.random.random(len(bonds))
    b = b / np.sum(b)
    b = bb * b
    c = np.random.random(len(commodities))
    c = c / np.sum(c)
    c = cc * c
    weights =  np.hstack((s,b,c))
    return weights
```


```python
# discard the benchmark (S&P500)
selected=assets[:-1]
number_of_bonds = len(bonds)
# table = get_data(selected, '3y',interval='1d').dropna()
table = data[assets[:-1]]
# calculate daily and annual returns of the stocks
returns_daily = table.pct_change()
returns_annual = returns_daily.mean() * 250

# get daily and annual covariance of returns of the stock
cov_daily = returns_daily.cov()
cov_annual = cov_daily * 250

# empty lists to store returns, volatility and weights of imaginary portfolios
port_returns = []
port_volatility = []
port_sharpe_ratio = []
stock_weights = []

# set the number of combinations for imaginary portfolios
num_assets = len(selected)
num_portfolios = 50000

# populate the empty lists with each portfolios returns,risk and weights
for single_portfolio in range(num_portfolios):
    weights = random_weights()
    returns = np.dot(weights, returns_annual)
    volatility = np.sqrt(np.dot(weights.T, np.dot(cov_annual, weights)))
    # store the return, volatility, Sharpe ratio and weights for this imaginary portfolio
    port_returns.append(returns)
    port_sharpe_ratio.append((returns - rf/100)/volatility)
    port_volatility.append(volatility)
    stock_weights.append(weights)

# a dictionary for Returns and Risk values of each portfolio
portfolio = {'Returns': port_returns,
             'Volatility': port_volatility,
             'sharpe_ratio': port_sharpe_ratio
            }

# extend original dictionary to accomodate each ticker and weight in the portfolio
for counter,symbol in enumerate(selected):
    portfolio[symbol+' Weight'] = [Weight[counter] for Weight in stock_weights]

# make a nice dataframe of the extended dictionary
df_ef = pd.DataFrame(portfolio)

# get better labels for desired arrangement of columns
column_order = ['Returns', 'Volatility','sharpe_ratio'] + [stock+' Weight' for stock in selected]

# reorder dataframe columns
df_ef = df_ef[column_order]
```


```python
# the optimal risky portfolio has the highest Sharpe Ratio
id = df_ef['sharpe_ratio'].idxmax()
max_sr_vol, max_sr_ret = df_ef['Volatility'][id], df_ef['Returns'][id]


plt.figure(figsize=(12,8))
plt.scatter(df_ef['Volatility'], df_ef['Returns'], c=df_ef['sharpe_ratio'], cmap='viridis')
plt.colorbar(label='Sharpe Ratio')
plt.xlabel('Volatility')
plt.ylabel('Return')
plt.scatter(max_sr_vol, max_sr_ret,c='red', s=50) # red dot
plt.show()
plt.savefig('../report/media/random_portfolios.png', bbox_inches='tight')
```


![png](FN4329_files/FN4329_42_0.png)



    <Figure size 432x288 with 0 Axes>


---
---
---
---
---
---


To plot the Efficient Frontier, an array of optimization problems must be solved.


```python
def portfolio_volatility(weights, cov_annual):
    return np.sqrt(np.dot(weights.T, np.dot(cov_annual, weights)))

def efficient_return(returns_annual, cov_annual, target):
    num_assets = len(returns_annual)
    args = (cov_annual)

    def portfolio_return(weights):
        return np.dot(weights, returns_annual)

    constraints = ({'type': 'eq', 'fun': lambda x: portfolio_return(x) - target},
                   {'type': 'eq', 'fun': lambda x: np.sum(x) - 1},
                   {'type': 'eq', 'fun': lambda x: np.sum(x[:len(stocks)]) - ss},
                   {'type': 'eq', 'fun': lambda x: np.sum(x[-len(commodities):]) - cc}
                  )
    bounds = tuple((0,1) for asset in range(num_assets))
    result = sco.minimize(portfolio_volatility, num_assets*[1./num_assets,], args=args, method='SLSQP', bounds=bounds, constraints=constraints)
    return result


def efficient_frontier(returns_annual, cov_annual, returns_range):
    efficients = []
    for ret in returns_range:
        efficients.append(efficient_return(returns_annual, cov_annual, ret))
    return efficients
```


```python
target = np.linspace(df_ef['Returns'].min(), df_ef['Returns'].max(), 50)
efficient_portfolios = efficient_frontier(returns_annual, cov_annual, target)
```


```python
# Final graph that includes:
#     1. the random portfolios
#     2. The efficient frontier
#     3. The optimal risky Portfolio
fig, ax = plt.subplots(figsize=(16, 12))

# plot (1) the random portfolios
plt.scatter(df_ef['Volatility'], df_ef['Returns'], c=df_ef['sharpe_ratio'], cmap='viridis')
cbar = plt.colorbar(label='Sharpe Ratio')

# plot (2) The Efficient Frontier
ax.plot([p['fun'] for p in efficient_portfolios], target, linestyle='-.',lw=3, color='black', label='Efficient Frontier')

# plot (3) the Optimal Risky Portfolio
plt.scatter(max_sr_vol, max_sr_ret,c='red', s=200, label='Optimal risky portfolio') 


# title, axes and legend
ax.set_title('Portfolio Optimization with Individual Stocks, Bonds and Commodities', fontsize=20)
ax.set_xlabel('annualised volatility', fontsize=16)
ax.set_ylabel('annualised returns', fontsize=16)
ax.legend(labelspacing=0.8,shadow=True, handlelength=1.5, fontsize=16)
plt.savefig('../report/media/random_portfolios_and_EF.png', bbox_inches='tight')
```


![png](FN4329_files/FN4329_47_0.png)



```python
# Final graph that includes:
#     1. the random portfolios
#     2. The efficient frontier
#     3. The optimal risky Portfolio
#     4. the risk-free portfolio
#     5. The CAL
#     6. The individual instruments
fig, ax = plt.subplots(figsize=(16, 12))

# plot (1) the random portfolios
plt.scatter(df_ef['Volatility'], df_ef['Returns'], c=df_ef['sharpe_ratio'], cmap='viridis')
cbar = plt.colorbar(label='Sharpe Ratio')

# plot (2) The Efficient Frontier
ax.plot([p['fun'] for p in efficient_portfolios], target, linestyle='-.',lw=3, color='black', label='Efficient Frontier')

# plot (3) the Optimal Risky Portfolio
plt.scatter(max_sr_vol, max_sr_ret,c='red', s=200, label='Optimal risky portfolio') 

# plot (4) the risk-free portfolio
plt.scatter(0, rf/100,c='red') 

# plot (5) the CAL
x = np.linspace(-0.1, df_ef['Returns'].max(), 100)
y = x * df_ef['sharpe_ratio'].max() + rf/100
ax.plot(x,y, label='Capital Allocation Line', lw=3)


# plot (6) the individual instruments
vol = returns_daily.std()*np.sqrt(252)
ax.scatter(vol,returns_annual,marker='^',s=200,color='gray')
for i in range(len(assets)-1):
        ax.annotate(df.index.values[i], 
                    (vol[i],returns_annual[i]), 
                    xytext=(10,0), textcoords='offset points', bbox=dict(boxstyle="round", fc="0.8"))
    

# title, axes and legend
ax.set_title('Portfolio Optimization with Individual Stocks, Bonds and Commodities', fontsize=20)
ax.set_xlabel('annualised volatility', fontsize=16)
ax.set_ylabel('annualised returns', fontsize=16)
ax.legend(labelspacing=0.8,shadow=True, handlelength=1.5, fontsize=16)
plt.savefig('../report/media/final_graph.png', bbox_inches='tight')
```


![png](FN4329_files/FN4329_48_0.png)



```python

```

## Question 8
<span style="color:blue">Keep a track record of the macro- and microeconomic events that influenced your assets/portfolio and offer explanations for some of them, if you deem necessary. Your explanations should also be accompanied with some quantitative verification.</span>

## Question 9
<span style="color:blue">Measure and evaluate your overall portfolio’s performance and compare it with the passive investment strategy. In this step, you should apply EXCEL’s Solver to evaluate several possible outcomes (in terms of risk and return) and explain each outcome. In that endeavor, compute the various performance measures we have learned. Decide on the best outcome for you. Discuss.</span>

## Question 10
<span style="color:blue">Finally, perform a critical evaluation of the project. In other words, what did this project accomplish for you regarding the study and (this simple) application of investment theories and strategies? What would be the implications of constructing, managing and evaluating such a portfolio for your portfolio? </span>
